"use strict";angular.module("blogApp",["ngAnimate","ngCookies","ngRoute","ngSanitize","ngTouch","restangular"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainController"}).when("/article-list",{templateUrl:"views/article_list.html",controller:"ArticleListController"}).when("/login",{templateUrl:"views/login.html",controller:"LoginController"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){}]).run(["$rootScope","$http","$location","tokenHandler",function(a,b,c,d){a.$on("event:unauthorized",function(){d.set({}),c.path("/login")})}]),angular.module("blogApp").controller("MainController",["$scope",function(a){}]),angular.module("blogApp").controller("ArticleListController",["$scope","BlogService","ArticleService","SubscriptionService",function(a,b,c,d){a.articles={},a.articles.infoMessage="Something happened",a.articles.showMessage=!1,a.articles.articleSearchCriteria="",a.articles.MODE_ARTICLE_LIST=0,a.articles.MODE_ARTICLE_ADD=1,a.articles.MODE_SUBSCRIBE=2,a.articles.mode=a.articles.MODE_ARTICLE_LIST,a.chooseArticle=function(b){for(var d=0;d<a.articles.article_list.length;d++)if(a.articles.article_list[d].id===b){a.articles.chosenArticle=a.articles.article_list[d],c.listOfCommentsForAnArticle(a.articles.chosenArticle,f,e);break}};var e=function(){console.log("Failed to get list of comments for an article")},f=function(b){a.articles.chosenComments=b},g=function(){console.log("Failed to get list of articles for a blog")},h=function(b){a.articles.article_list=b,a.articles.chosenArticle=b[0],c.listOfCommentsForAnArticle(a.articles.chosenArticle,f,e)},i=function(b){a.articles.listOfBlogs=b,a.articles.chosenBlog=b[0],c.listOfArticlesForBlog(a.articles.chosenBlog,h,g)},j=function(){console.log("Failed to get list of blogs")};a.successForArticlePost=function(b){a.articles.article_list.push(b)},a.failureForArticlePost=function(){console.log("Failed to post article")},a.showNewArticleForm=function(){a.articles.mode=a.articles.MODE_ARTICLE_ADD,a.articles.newArticle={}},a.addNewArticle=function(){a.articles.mode=a.articles.MODE_ARTICLE_LIST,a.articles.newArticle.blog_id=a.articles.chosenBlog.id,c.postArticle(a.articles.article_list,a.articles.newArticle,a.successForArticlePost,a.failureForArticlePost)},a.cancelNewArticle=function(){a.articles.mode=a.articles.MODE_ARTICLE_LIST},a.showSubscriptionForm=function(){a.articles.mode=a.articles.MODE_SUBSCRIBE},a.cancelNewSubscription=function(){a.articles.mode=a.articles.MODE_ARTICLE_LIST,a.articles.subscription={}},a.successForPostSubscription=function(a){console.log("Success for post subscription")},a.failureForPostSubscription=function(){console.log("Failed to post a new subscription")},a.successForListOfSubscriptions=function(b){a.articles.subscriptions=b,a.articles.subscription.blog_id=a.articles.chosenBlog.id,d.postSubscription(b,a.articles.subscription,a.successForPostSubscription,a.failureForPostSubscription)},a.failureForListOfSubscriptions=function(){console.log("Failed to get list of subscriptions")},a.addNewSubscription=function(){a.articles.mode=a.articles.MODE_ARTICLE_LIST,d.listOfSubscriptions(a.articles.chosenBlog,a.successForListOfSubscriptions,a.failureForListOfSubscriptions)},b.listOfBlogs(i,j)}]),angular.module("blogApp").controller("CommentsController",["$scope","ArticleService","CommentService",function(a,b,c){a.articles.show_comment_input=!1,a.articles.newComment={},a.newComment=function(b){a.articles.newComment={},a.articles.show_comment_input=!0},a.successForPost=function(b){a.articles.show_comment_input=!1,a.articles.newComment={},a.articles.chosenComments.push(b)},a.failureForPost=function(){a.articles.show_comment_input=!1,a.articles.newComment={},console.log("Failed to post new comment")},a.addNewComment=function(){a.articles.newComment.article_id=a.articles.chosenArticle.id,c.postComment(a.articles.chosenComments,a.articles.newComment,a.successForPost,a.failureForPost)},a.cancelNewComment=function(){a.articles.show_comment_input=!1,a.articles.newComment={}}}]),angular.module("blogApp").controller("HeaderController",["$scope","$http","$rootScope","$location","tokenHandler","Restangular",function(a,b,c,d,e,f){a.authenticated=!1,a.areWeAuthenticatedWithRails=function(){f.setRequestSuffix(".json"),f.setBaseUrl("/api/v1");var b=f.all("people");b.getList().then(function(){a.authenticated=!0},function(){a.authenticated=!1})},a.areWeAuthenticatedWithRails(),a.$on("event:authenticated",function(b){a.authenticated=!0}),a.$on("event:signedout",function(b){a.authenticated=!1}),a.isActive=function(a){var b=a.split(","),c=!1;return b.forEach(function(a){a===d.path()&&(c=!0)}),c},a.logout=function(){b({url:"/api/v1/users/sign_out",method:"DELETE"}).success(function(a){a.success?(e.set({}),c.$broadcast("event:signedout"),d.path("/")):console.log("Failed to logout")})},a.showMenu=function(){return"/home"!==d.path()}}]),angular.module("blogApp").factory("tokenHandler",["$rootScope","$http","$q",function(a,b,c){var d=null,e={set:function(a){d=a},get:function(){return d?d:void a.$broadcast("event:unauthorized")}};return e}]),angular.module("grBlogFilters",[]),angular.module("blogApp").service("BlogService",["Restangular",function(a){a.setRequestSuffix(".json"),a.setBaseUrl("/api/v1"),this.listOfBlogs=function(b,c){var d=a.all("blogs").getList();return d.then(b,c),d}}]),angular.module("blogApp").service("ArticleService",["Restangular",function(a){a.setRequestSuffix(".json"),a.setBaseUrl("/api/v1"),this.listOfArticlesForBlog=function(a,b,c){var d=a.getList("articles");return d.then(b,c),d},this.listOfCommentsForAnArticle=function(a,b,c){var d=a.getList("comments",{article_id:a.i});return d.then(b,c),d},this.postArticle=function(a,b,c,d){var e=a.post({article:b});return e.then(c,d),e}}]),angular.module("blogApp").service("CommentService",["Restangular",function(a){a.setRequestSuffix(".json"),a.setBaseUrl("/api/v1"),this.postComment=function(a,b,c,d){var e=a.post({comment:b});return e.then(c,d),e}}]),angular.module("blogApp").service("SubscriptionService",["Restangular",function(a){a.setRequestSuffix(".json"),a.setBaseUrl("/api/v1"),this.postSubscription=function(a,b,c,d){var e=a.post({subscription:b});return e.then(c,d),e},this.listOfSubscriptions=function(a,b,c){var d=a.getList("subscriptions");return d.then(b,c),d}}]);